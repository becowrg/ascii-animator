<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Line Animator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles if needed, Tailwind is preferred */
        body {
            font-family: 'Inter', sans-serif; /* Default font */
        }
        /* Ensure monospace font for the animation display and input */
        #ascii-display, #frames-input {
            font-family: monospace, 'Courier New', Courier;
            white-space: pre; /* Preserve whitespace and line breaks */
        }
        #ascii-display {
             overflow-x: auto; /* Add scroll if content overflows */
             min-height: 1.5em; /* Ensure space even if empty */
        }
         #frames-input {
            min-height: 150px; /* Give some more initial height */
            white-space: pre; /* Important for seeing spaces correctly */
            overflow-wrap: normal; /* Prevent wrapping */
            overflow-x: auto; /* Allow horizontal scrolling */
         }
         /* Hide the actual file input */
         #file-input {
            display: none;
         }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="bg-white p-6 rounded-lg shadow-md w-full max-w-2xl text-center">
        <h1 class="text-2xl font-bold mb-4 text-gray-800">ASCII Line Animator</h1>

        <div id="ascii-display" class="bg-gray-900 text-green-400 p-4 rounded-md text-lg mb-4 border border-gray-700">
            Enter frames below, load from file, or load defaults, then click Start.
        </div>

        <div class="mb-4">
            <label for="frames-input" class="block text-sm font-medium text-gray-700 mb-1 text-left">Animation Frames (one per line):</label>
            <textarea id="frames-input" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="[ Frame 1 ]&#10;{ Frame 2 }&#10;< Frame 3 >"></textarea>
            <div class="mt-2 flex flex-wrap justify-start gap-2">
                 <button id="load-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out">
                    Load Frames from Textarea
                </button>
                 <button id="save-button" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out">
                    Save Frames to File
                </button>
                 <button id="load-file-button" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out">
                    Load Frames from File
                </button>
                 <input type="file" id="file-input" accept=".txt, text/plain">
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-3 mb-4 border-t pt-4 mt-4">
            <button id="start-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out w-full sm:w-auto">
                Start
            </button>
            <button id="stop-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out w-full sm:w-auto">
                Stop
            </button>
            <div class="flex items-center space-x-2 w-full sm:w-auto">
                 <label for="speed-input" class="text-sm font-medium text-gray-700 whitespace-nowrap">Speed (ms):</label>
                 <input type="number" id="speed-input" value="200" min="50" max="2000" step="50" class="border border-gray-300 rounded-md p-1 w-20 text-center focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
         <div id="message-box" class="mt-2 text-sm text-gray-600 min-h-[1.25em]"></div>
    </div>

    <script>
        // --- DOM Elements ---
        const displayElement = document.getElementById('ascii-display');
        const framesInput = document.getElementById('frames-input');
        const loadButton = document.getElementById('load-button');
        const saveButton = document.getElementById('save-button');
        const loadFileButton = document.getElementById('load-file-button'); // The visible button
        const fileInput = document.getElementById('file-input'); // The hidden file input
        const startButton = document.getElementById('start-button');
        const stopButton = document.getElementById('stop-button');
        const speedInput = document.getElementById('speed-input');
        const messageBox = document.getElementById('message-box');

        // --- State Variables ---
        let frames = []; // Initialize frames array - will be populated from textarea
        let currentFrameIndex = 0; // Index of the frame currently shown
        let intervalId = null;     // ID returned by setInterval, used to stop
        let animationSpeed = parseInt(speedInput.value, 10) || 200; // Initial speed in milliseconds

        // --- Functions ---

        /**
         * Loads frames from the textarea input into the frames array.
         * Called by the "Load Frames from Textarea" button or after loading a file.
         */
        function loadFrames() {
            stopAnimation(); // Stop any current animation
            const inputText = framesInput.value;
            // Split by newline characters (handles both \n and \r\n)
            // Filter out empty lines that might result from splitting
            frames = inputText.split(/\r?\n/).filter(line => line.trim() !== '' || line.length > 0); // Keep lines that are just spaces, filter truly empty lines

            currentFrameIndex = 0; // Reset frame index

            if (frames.length > 0) {
                displayElement.textContent = frames[0]; // Show the first frame
                // Adjust message slightly depending on whether it was triggered by user or file load
                if (event && event.target.id === 'load-button') {
                     displayMessage(`${frames.length} frame(s) loaded from textarea. Click Start to animate.`);
                } else {
                     // Assume called after file load if event target isn't the button
                     displayMessage(`${frames.length} frame(s) processed from file. Click Start to animate.`);
                }

            } else {
                displayElement.textContent = 'No valid frames entered or loaded.';
                displayMessage('Error: Please enter or load at least one frame.');
                frames = []; // Ensure frames is empty if input was invalid
            }
             console.log("Frames processed:", frames);
        }

        /**
         * Saves the content of the frames textarea to a text file.
         */
        function saveAnimation() {
            const textToSave = framesInput.value;
            if (!textToSave) {
                displayMessage("Nothing to save. Enter frames in the textarea first.");
                return;
            }

            // Create a Blob (Binary Large Object) from the text
            const blob = new Blob([textToSave], { type: 'text/plain' });

            // Create a temporary URL for the Blob
            const url = URL.createObjectURL(blob);

            // Create a temporary anchor element to trigger the download
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ascii-animation.txt'; // Suggested filename
            document.body.appendChild(a); // Append anchor to body (needed for Firefox)
            a.click(); // Programmatically click the anchor to trigger download

            // Clean up: remove the anchor and revoke the temporary URL
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            displayMessage("Animation frames saved as ascii-animation.txt");
            console.log("Save triggered.");
        }

        /**
         * Triggers the hidden file input when the visible "Load Animation from File" button is clicked.
         */
        function triggerFileInput() {
            fileInput.click(); // Programmatically click the hidden file input
        }

        /**
         * Handles the file selection event from the hidden file input.
         * Reads the file content and loads it into the textarea.
         * @param {Event} event - The file input change event object.
         */
        function handleFileLoad(event) {
            const file = event.target.files[0];
            if (!file) {
                displayMessage("No file selected.");
                return; // No file selected
            }

            // Check if the file type is plain text (basic check)
            if (file.type && !file.type.startsWith('text/plain')) {
                 displayMessage(`Error: Invalid file type (${file.type}). Please select a .txt file.`);
                 // Reset file input value to allow selecting again
                 event.target.value = null;
                 return;
            }


            const reader = new FileReader();

            // Define what happens when the file is successfully read
            reader.onload = function(e) {
                const fileContent = e.target.result;
                framesInput.value = fileContent; // Put content into the textarea
                displayMessage(`File "${file.name}" loaded. Processing frames...`);
                // Automatically process the loaded frames
                loadFrames();
            };

            // Define what happens on a file read error
            reader.onerror = function(e) {
                console.error("File reading error:", e);
                displayMessage(`Error reading file "${file.name}".`);
            };

            // Read the file as text
            reader.readAsText(file);

            // Reset file input value so the 'change' event fires even if the same file is selected again
            event.target.value = null;
        }


        /**
         * Displays the next frame in the animation sequence.
         */
        function nextFrame() {
            if (!frames || frames.length === 0) {
                 displayMessage("Error: No frames loaded to animate.");
                 stopAnimation();
                 return;
            }
            displayElement.textContent = frames[currentFrameIndex];
            currentFrameIndex = (currentFrameIndex + 1) % frames.length; // Loop using modulo
        }

        /**
         * Starts the animation loop.
         */
        function startAnimation() {
            displayMessage(""); // Clear status message
            if (intervalId !== null) { stopAnimation(); } // Stop existing animation

            if (!frames || frames.length === 0) {
                 displayMessage("Error: Please load frames first (from textarea or file).");
                 return;
            }

            animationSpeed = parseInt(speedInput.value, 10);
            if (isNaN(animationSpeed) || animationSpeed < 50) {
                animationSpeed = 200;
                speedInput.value = animationSpeed;
                displayMessage("Info: Speed reset to 200ms (minimum 50ms).");
            }

            intervalId = setInterval(nextFrame, animationSpeed);
            console.log(`Animation started with interval ID: ${intervalId}, speed: ${animationSpeed}ms`);
        }

        /**
         * Stops the animation loop.
         */
        function stopAnimation() {
            if (intervalId !== null) {
                clearInterval(intervalId);
                intervalId = null;
                console.log("Animation stopped.");
            } else {
                 console.log("Animation was not running.");
            }
        }

        /**
         * Displays a message to the user.
         * @param {string} text - The message to display.
         */
        function displayMessage(text) {
            messageBox.textContent = text;
        }


        // --- Event Listeners ---
        loadButton.addEventListener('click', loadFrames); // Load from textarea
        saveButton.addEventListener('click', saveAnimation); // Save to file
        loadFileButton.addEventListener('click', triggerFileInput); // Trigger hidden file input
        fileInput.addEventListener('change', handleFileLoad); // Handle file selection
        startButton.addEventListener('click', startAnimation); // Start animation
        stopButton.addEventListener('click', stopAnimation); // Stop animation

        // Speed input change listener (unchanged)
        speedInput.addEventListener('change', () => {
             const newSpeed = parseInt(speedInput.value, 10);
             if (isNaN(newSpeed) || newSpeed < 50) {
                 displayMessage("Error: Speed must be a number >= 50.");
                 return;
             }
             animationSpeed = newSpeed;
             displayMessage("");
             if (intervalId !== null) {
                 console.log(`Restarting animation with new speed: ${animationSpeed}ms`);
                 startAnimation();
             }
        });

        // --- Initial State ---
        stopAnimation();
        displayMessage(""); // Clear initial message

    </script>

</body>
</html>
